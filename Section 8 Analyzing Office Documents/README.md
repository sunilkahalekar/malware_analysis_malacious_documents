## Principals of Analyzing Office Documents


We are going to start looking at how to analyze Microsoft Office documents. We will start off by looking at the principles of analyzing office documents, office attacks, one
of the many ways in which malware authors are now using in order to infiltrate and in fact, computers and they can do so using three methods.

First is by using macros, macros, VBA scripts, which are embedded inside the office document and will execute the office document is open.

It is one of the most powerful VBA scripting language available and can do almost anything which the malware onto, which is the second is to use features of the office programs, for example, DDE, that can also automate certain tasks and execute certain commands. The third is to take advantage of vulnerabilities within the office programs themselves by using a splice to do so.

Document analysis consists of looking for certain keywords, certain signs of malicious elements, for example, scripts, for example, VBA macros, he will look for commands in the documents. So if you come across any kind of document that you raise suspicion and also you should look out for embedded files and these embedded files could be binary files or even compressed or encoded obfuscated files within the Microsoft document.

First degree need to be aware of that is that there are two versions of Microsoft Office, also known as office document formats.

The first version is the older version, which is before 2007 and in this version, the Microsoft documents will have these extensions, the D.O.C., the Excel and PBT PowerPoint.

This story format is also known as structured storage format or as has every shot and after 2007, Microsoft released a new format also known as OpenOffice XML format and in this format, the Microsoft document itself is actually an archive, a sepak containing XML site. And if this is a format, then you will see the extension, the O.C. X, dot, x, x and so on.

And in this format, if you see it is done in the U.S. and it means that it has got my crew excited. However, even me counting macros that may not be permitted to run the smackeroos by certain authors have ways in which it can be overcome. 

So these are the two main office formats you should be aware.

Let's just take a look at the SS effort in the old format structured storage format.

The header of this structure will contain a string in hexadecimal, which is the zero one one easy one, be one twenty one. This is easy to remember because these ossy f i e Duquan hecho speak to denote certain strings, for example, in this case dogfighter.

And then below that you will have a hierarchy of fast system to start, which is the root storage and below the RESTARICK you have children, you can have stories as well as streams, and it is in the streams in which you can find some other data, including inverted files. One of the important and useful tool in studying analysing the excessive format for acquisition of this document is the Setto or E 2s, where it does consist of several scripts, for example, or Browse, whose function is to view and extract streams or times is used to extract time. So timestamp and this is useful in order to gain some metadata information about when the malicious document was created.

We also have or idea, too, which is useful for looking for malicious characteristics. This might be the first to use when you are doing triaging. Similar to what we did when we were studying, analyzing PDA documents, we used PDA ID for triaging. Then we also have the oil Yuva tool, which is used for extracting VBA scripts.

And VBA could also be used for the new Microsoft Office format, which is the archive.

Is it style format. These are some this is a link for further information.

If you wish to look into more details about these tools and these tools also come ranks.

Next, we will look at a new Microsoft Office format, which is the Open Office XML format, as we have seen at the early stages of this course, this is an open XML format with the file, with the extension DCX. Inside it, you have an archive consisting of several files, the XML files and the location in various directories and also directory directory, which contains the web, a project being far. If the VBA project beautifies this, it means that this document contains VBA scripts, also known as macro's.

However, normally we behave, we take being will not be allowed to execute you extension, you don't see X. However, as I mentioned earlier, now the others may have ways to overcome this limitation. It is important to remember that this format is a binary format. 

So we can't open it directly with her editor to look at it.

Any other format is deoxy and when you see em, you can be certain that there is a VBA project being

filed within it.

And therefore he has got the VBA macro's the tools that I use for analyzing Microsoft Office documents,

metadata to use and example EXIF to which we also have used before when we were doing our PDF files

analysis, then we can also use for signature retention Zik done plus YAARA and for studying and extracting

VBA scripts from the office file you can use already VBA.

The overflowing analyzing office documents, when you are faced with an office document, the first

step is to determine whether it is the old format, which is the essay format, or is it a new open

office format.

So we need to determine the document time and we can use for identification tools for that.

Second, we will search for malicious indicators using tools in order to look for keywords, files,

structures, file names and so on and enter.

If you were to find any hidden or embedded files, we will extract those files and continue analysis.

So that is all for the principals analyzing these documents.

Thank you for watching.

I'll see you in the next video.

##  Analyzing Office Documents and Extracting VBA Macro Scripts

we are going to do a lot practical on analyzing a malicious office document. we have already done some preliminary analysis, several lessons and go.

What we did was we use a EXIF tool to take a look at the metadata. And if we saw it, we did some time ago and we saw the timestamp.

Time to time here. As you know, this is Russian origin and using their office form, it is near all of his helmet.

So it is the same structure. Storage for me said, and it is not open office, I format for it, and you also you are asking me for

on this just to refresh your memory. And yet I confirmed that contains VVA macro. So now we are going to continue with our analysis with had tools, we are going to see if we can try

to extract the VVA macro from this fund. The first thing we are going to use the EIB. So I open a new window here and go to the location of this railway.

And I wish I'd followed by the name of the document, so it shows us that this is a Microsoft Word document.

It is not encrypted.

And here is a document.

And it also contains VVA Macro's next for use in order to call Hawary Times. Or any time show us the time stamp for this document and you can see it has all the time stamps in there and has the same date, which is two zero one five February 10. And if you compare this with our EXIF to metadata, we can correlate them and confirm they are the same. Immigration is 2015 February and modified it more in 2015, February 10, which is the one found here February 10.

So this more or less confirms that this is the date in which he was created. And you can see also a lot of stories, objects here, as you can see, and he also contains wee wee, wee, wee, wee, wee a micro.

So the next step is to see if we can try to extract these VBA macro.

To do that, we can use the Avivah program. So let's open a new window and go into our mailbag document. If you just came with any options, he would tell you what he can do and you can see there's a lot of options here, a lot of things he can do. OK, so now we are going to use our Avivah on our back office document. And you're not going to specify any options. And you can see it's giving us a lot of information, including the VVA scripture and one of the important

section is at the bottom, which contains a table, a summary of the entire analysis.

You can see that he has authorized, which means that this document how to execute something, then

he is hoping.

And the suspicious elements are incorrect, as you can see, the open kiewa, which can open the file.

And he's going to kill Give Me Schmidly file show, which can run executable file system common.

User agent, which means that it is capable of downloading additional Baylock from the Internet CAGR,

which may be used to obfuscate string's.

And he also got high strings and base64 strings, which is also useful obfuscation.

Now, every school right to the top, this, you can see the VVA cell, which has been extracted by

WAVY, and you can see here there's a lot of obfuscation using string obfuscation, and he's trying

to make it difficult for analysis.

You will also see some location of the file system here and the technical term as well as here.

So this could be a location where this group may the right things to we also see some high service objects,

which means that this number is probably trying to run some tests on the operating system.

And we see lots and lots of obfuscated strings.

So now let's see if we can dump this into a separate file to extract the VBA script from this document

we can use to Huelva here today, C option, and then we redirect the output to a file of our own and

we will call it that duckweed V.V. extension.

And now you see that a new file here.

So we can open this here, right?

Clicking Open this.

We we show us to you could. So this is the father has been done, and you can see on top here, there are some strings that has

been inserted by whoever and we do need them. You just cut them off since they are not part of the VBA script and you scroll down, you see some more

at the bottom. You can also cut this off, this part here.

Clean up the forest, clean and also properly formatted by visitors to local and remember to save it.

Now, this fire is ready for use in further analysis in the future.

Listen.

So we are stretched to the maybe a script, which is the objective of this lesson.

So thank you for watching.

I'll see you in the next one.
